<include file="Component/header"/>
<style src="__LIB__/ueditor/third-party/xiumi/xiumi-ue-v5.css"></style>


<style>
    #edui1{z-index: 1 !important;}
    .layui-disabled{color: #000 !important;font-weight:bold;font-size:15px;font-style: italic;}
    .img-thumb{max-width: 70px;max-height: 70px;margin: 10px;cursor: pointer;margin-left: 15px;}
    .layui-table-page{display: none;height: 0px;}
</style>
<div class="form-block" >

    <if condition="$from eq 'copy'">
        <form action="{:U('Admis/Article/copyArticle')}" method="post" enctype="multipart/form-data">
        <else/>
            <form action="{:U('Admis/Article/addArticleHandle')}" method="post" enctype="multipart/form-data">
        </if>

        <div class="layui-form layuimini-form form-main" >
            <div style="position: absolute;right: 50px;top: 50px;">
                <if condition="$from eq 'copy'">
                    <button class="layui-btn" lay-submit >复制</button>
                    <else/>
                    <button class="layui-btn" lay-submit >保存</button>
                </if>

                <if condition="($from eq 'index') or ($from eq 'copy')">
                    <a href="{:U('Article/index')}" class="layui-btn layui-btn-primary"  >返回</a>
                    <else/>
                    <a onclick="history.go(0)" class="layui-btn layui-btn-primary"  >取消</a>
                </if>
            </div>

            <if condition="$Think.get.from eq 'copy'">
                <p style="width: 100%;text-align: center;font-size: 15px;margin-bottom: 20px;color: green;font-weight: bold">复制文章</p>
            </if>
        <div class="layui-form-item" >



            <label class="layui-form-label required">文章标题</label>
            <div class="layui-input-block">
                <input type="text" value="{$article.title}" lay-verify="required" lay-reqtext="标题不能为空" class="layui-input" name="title" id="title" />
            </div>
        </div>
            <if condition="$Think.get.from !='copy'">
                <div class="layui-form-item">
                    <label class="layui-form-label required">所属导航</label>
                    <div class="layui-input-block">
                        <select name="cid"  lay-search  size="2" id="cid" lay-filter="aihao"  lay-verify="required" lay-reqtext="请选择导航">
                            <option value="">选择导航</option>
                            <foreach name="channel" item="ch">
                                <option value="parent_{$ch.id}" disabled <if condition="$ch['id'] eq $article['parent_cid']">selected="selected"</if>>{$ch.name}</option>
                                <foreach name="ch.son" item="son">
                                    <option   value="{$son.id}" <if condition="($son['id'] eq $article['cid']) or ($lastCid eq $son['id'])">selected="selected"</if> >{$son.name}</option>
                                </foreach>
                            </foreach>
                        </select>
                    </div>
                </div>
            </if>

            <if condition="$Think.get.from =='copy'">
                <div class="layui-form-item">
                    <label class="layui-form-label required">选择导航模块</label>
                    <div class="layui-input-block">
                        <input type="text" name="" placeholder="" autocomplete="off"  lay-verify="required" lay-reqtext="导航不能为空"
                               class="layui-input" id="demo" value="" ts-selected="" >
                        <input type="hidden" name="muti_cid"  id="muti_cid" value="" >
                    </div>
                </div>
            </if>


        <div class="layui-form-item">
            <label class="layui-form-label">置顶设置</label>
            <div class="layui-input-block">
                <input type="checkbox" name="top" lay-skin="switch" <if  condition="$article['top']"> checked </if>  lay-text="文章置顶|不置顶">
            </div>
        </div>
            <div class="layui-form-item">
                <label class="layui-form-label">封面缩略图</label>
                <div class="layui-input-block"><a  href="javascript:;" class="{$theme.form.upload.style}" id="uploadImgBtn">选择图片</a>
                    <span class="layui-word-aux"><small>建议大小600px*400px 无缩略图自动抓取文章内容合适的图片</small></span>
                    <div class="slide-img">
                        <if condition="$article and $article['thumb']">
                            <a href="{$article.thumb}" target="_blank" id="thumb"><img src="{$article.thumb}" class="img-thumb"/></a>
                            <a class="{$theme.databar.delete.style} "  title="删除" id="delete-banner">{$theme.databar.delete.icon}</a>

                        </if>
                    </div>
                    <input type="hidden" name="thumb" value="{$article.thumb}"/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label required">显示发布日期</label>
                <div class="layui-input-block">
                    <input type="text"  style="width: 200px"  value="{$showCreateTime}" name="show_create_time" id="show_create_time" class="layui-input" readonly  lay-verify="required"/>
                </div>
            </div>
            <!--
            <div class="layui-form-item">
                <label class="layui-form-label">详情页横幅</label>
                <div class="layui-input-block">&nbsp;&nbsp;&nbsp;
                    <a  href="javascript:;" class="{$theme.form.upload.style}" id="uploadImg2Btn">选择图片</a>
                    <span class="layui-word-aux"><small>最佳大小 900px*400px 可不上传</small></span>
                    <div class="slide-img2">
                        <if condition="$article">
                            <a href="{$article.banner}" target="_blank"><img src="{$article.banner}" class="img-thumb"/></a>
                        </if>
                    </div>
                    <input type="hidden" name="banner" value="{$article.banner}"/>
                </div>
            </div>
            -->
            <if condition="!$user['isNewsPoster']">
                <div class="layui-form-item">
                    <label class="layui-form-label">文章审核</label>
                    <div class="layui-input-block">
                        <input type="radio" name="audit" value="0" title="未审核" <if  condition="$article['audit'] eq 0"> checked </if> >
                        <input type="radio" name="audit" value="1" title="审核通过" <if  condition="$article['audit'] eq 1"> checked </if>>
                        <input type="radio" name="audit" value="2" title="审核不通过" <if  condition="$article['audit'] eq 2"> checked </if>>
                    </div>
                </div>
            </if>
        <div class="layui-form-item">
            <label class="layui-form-label">文章内容</label>
            <div class="layui-input-block">
                <textarea id="content" name="content"  style="height:500px;width: 870px;z-index: -100">{$article.content}</textarea>

            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">

                <input type="hidden" name="token" value="{$token}"/>
                <input type="hidden" name="id" value="{$article.id}"/>
                <input type="hidden" name="from" value="{$from}"/>

                <if condition="$Think.get.from eq 'copy'">
                    <button class="layui-btn" lay-submit >复制</button>
                    <else/>
                    <button class="layui-btn" lay-submit >保存</button>
                </if>

                <if condition="($from eq 'index') or ($from eq 'copy')">
                    <a href="{:U('Article/index')}" class="layui-btn layui-btn-primary"  >返回</a>
                    <else/>
                    <a onclick="history.go(0)" class="layui-btn layui-btn-primary"  >取消</a>
                </if>
            </div>
        </div>
    </div>
    </form>
</div>


<include file="Component/footer"/>


<script type="text/javascript" src="__LIB__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="__LIB__/ueditor/ueditor.all.js"></script>
<script type="text/javascript" src="__JS__/ueditorConfig.js"></script>
<script type="text/javascript" src="__JS__/upload/upload.js"></script>
<script type="text/javascript" src="__JS__/upload/upload2.js"></script>
<script src="__LIB__/ueditor/third-party/xiumi/xiumi-ue-dialog-v5.js" charset="utf-8"></script>
<script src="__LIB__/ueditor/third-party/135editor/135editor.js" charset="utf-8"></script>
<script type="text/javascript" src="__LIB__/My97DatePicker/WdatePicker.js"></script>


<script type="text/javascript">

    $(function(){
        //初始化编辑器
        initEditor();
        $("#cancelBtn").click(function(){
            history.go(0);
        });
        uploadHandle.upload({
            id:"uploadImgBtn",
            name:'file', //服务端接收的名称
            fileType:'image', //允许上传的文件类型
            url:"{:U('uploadFile')}",
            callback:function(data){
                $('.slide-img').html('<img class="img-thumb"  src="'+data.url+'"/>');
                $("input[name=thumb]").val(data.path);
            }
        });

        uploadHandle2.upload({
            id:"uploadImg2Btn",
            name:'file', //服务端接收的名称
            fileType:'image', //允许上传的文件类型
            url:"{:U('uploadFile2')}",
            callback:function(data){
                $('.slide-img2').html('<img class="img-thumb" src="'+data.url+'"/>');
                $("input[name=banner]").val(data.path);
            }
        });


        $("#delete-banner").click(function(){
            $("input[name=thumb]").val('');
            $(this).remove();
            $("#thumb").remove();
        });

        if("{$articleHandleMsg}"){
            layerSuc("{$articleHandleMsg}");
        }

        $("#show_create_time").click(function(){
            WdatePicker({el:$("#show_create_time")[0],dateFmt:'yyyy-MM-dd HH:mm:ss',startDate:'{$showCreateTime}',minDate:'1970-01',maxDate:'2030-01',alwaysUseStartDate:true});
        });
    });



    layui.use(['table', 'form', 'tableSelect'], function () {
        var $ = layui.jquery,
            table = layui.table,
            form = layui.form,
            tableSelect = layui.tableSelect;

        //多选
        tableSelect.render({
            elem: '#demo',
            searchKey: 'keyword',
            searchPlaceholder: '',
            table: {
                url: '{:U("getChannelJson")}?cid={$article.cid}',
                cols: [[
                    { type: 'checkbox' },
                    { field: 'id', title: 'ID(支持多选)', width: 150 },
                    { field: 'name', title: '导航模块', width: 300 },
                ]]
            },
            done: function (elem, data) {
                var NEWJSON = [];
                var cid = [];
                layui.each(data.data, function (index, item) {
                    NEWJSON.push(item.sonname);
                    cid.push(item.id);
                })
                elem.val(NEWJSON.join(","));
                $("#muti_cid").val(cid.join([',']));
            },
            page: true,
            limit:100
        })
    });
</script>